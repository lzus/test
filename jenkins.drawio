<mxfile host="app.diagrams.net" modified="2023-12-13T16:15:51.120Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" etag="CPXVMyAQ75Oa-ONMOqSb" version="22.1.8" type="github">
  <diagram name="第 1 页" id="0g3aWzYnLtcXMj87QazC">
    <mxGraphModel dx="2608" dy="530" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="qVIc31OxtEuiZdBQp6vo-1" value="Launcher类" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-2" value="remoting" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="80" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-3" value="main Thread" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="120" y="170" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-4" value="agent" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1010" y="90" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-5" value="master" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1000" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-6" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="440" y="180" as="sourcePoint" />
            <mxPoint x="740" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-7" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;span style=&quot;color:#00627a;&quot;&gt;parseJnlpArguments&lt;/span&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="480" y="90" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-8" value="访问http://127.0.0.1:8080/computer/node1/jenkins-agent.jnlp 获取remoting启动参数" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="430" y="140" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-9" value="Main类&lt;br&gt;createEngine&lt;br&gt;startEngine" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-10" value="main Thread" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="120" y="275" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-11" value="Engine类" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-12" value="Thread0" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="390" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-13" value="创建线程池pool,&lt;br&gt;做一些workdir的创建初始化工作" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="390" y="290" width="236" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-14" value="1.创建IOHub,&lt;br&gt;创建selector,并用pool启动两个线程" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="407" y="370" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-15" value="2.创建SSLContext" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="450" y="430" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-17" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="530" y="370" width="20" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-23" value="IOHub" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="570" y="350" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-24" value="pool-thread0" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="760" y="340" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-25" value="pool-thread1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="760" y="393.75" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-26" value="IOHub #&amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;IOHubSelectorWatcher&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="570" y="382.5" width="200" height="37.5" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-27" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1040" y="880" as="sourcePoint" />
            <mxPoint x="1040" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-28" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="610" as="sourcePoint" />
            <mxPoint x="1030" y="610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-29" value="访问：http://127.0.0.1:8080/tcpSlaveAgentListener/， 获取jenkins的socket端口和公钥，连接协议（JNLP4-connect, ping）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="560" y="570" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-30" value="获取endpoint(jenkins主节点)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="390" y="560" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-31" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="374" y="745" as="sourcePoint" />
            <mxPoint x="1034" y="745" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-32" value="根据endpoint信息用SocketChannel打开到master的socket连接" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="394" y="710" width="350" height="45" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-33" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;5.connectTcp&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="294" y="710" width="90" height="25" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-34" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;4.JnlpEndpointResolver.resolver&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="294" y="540" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-35" value="3.创建JnlpProtocolHandler预备用于交互数据的处理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="290" y="490" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qVIc31OxtEuiZdBQp6vo-36" value="获取端口后还会发起一个到master:port的socket连接请求，以验证端口的有效性，随即断开连接" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="566" y="620" width="314" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-1" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="880" as="sourcePoint" />
            <mxPoint x="940" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-30" value="Socket" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="S4PnsvHIbKOA204sQYgr-1" vertex="1" connectable="0">
          <mxGeometry x="-0.5306" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-2" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;NetworkLayer&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-3" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;.AppleSystemUIFont&amp;quot;; font-size: 9.8pt;&quot;&gt;AgentProtocolClientFilterLayer&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="70" y="850" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-4" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ApplicationLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-660" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-5" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolLayer&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-400" y="810" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-6" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolLayer&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="810" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-7" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolLayer&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="320" y="810" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-8" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="-149.37" y="330.63" width="43.13" height="916.25" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-9" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolStack&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="63" y="720" width="117" height="50" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-10" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;AckFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-70" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-11" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolLayer&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-630" y="811" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="920" as="targetPoint" />
            <mxPoint x="360" y="1050" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-17" value="IOHub" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="500" y="880" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-18" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ReadableByteChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="510" y="810.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-19" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;WritableByteChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="510" y="840.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-20" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;InputStream&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="670" y="810.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-21" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;SocketChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="790" y="810.5" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-23" value="包装" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="600" y="840.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-24" value="包装" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="750" y="840.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-25" value="包装" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="600" y="810.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-26" value="包装" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="740" y="810.5" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-27" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;OutputStream&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="650" y="840.5" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-28" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;SocketChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="790" y="840.5" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-31" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;BIONetworkLayer：&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="450" y="781" width="150" height="29" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-32" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;NIONetworkLayer：&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="450" y="920" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-33" value="in：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="414" y="810" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-34" value="out：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="414" y="841" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-35" value="in：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="410" y="950" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-36" value="out" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="407" y="980" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-37" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;SocketChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="467" y="950" width="126" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-38" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;SocketChannel&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="470" y="980" width="126" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-44" value="&lt;pre style=&quot;border-color: var(--border-color); font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;Ptr recvHead&lt;/pre&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=middle;childLayout=stackLayout;horizontal=1;startSize=29;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="294" y="1060" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-46" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;font face=&quot;JetBrains Mono, monospace&quot; color=&quot;#080808&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;layer = networklayer&lt;br&gt;&lt;/span&gt;&lt;/font&gt;nextSend = null&lt;br&gt;nextRecv =&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;" parent="S4PnsvHIbKOA204sQYgr-44" vertex="1">
          <mxGeometry y="29" width="210" height="51" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="S4PnsvHIbKOA204sQYgr-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="395" y="1150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-47" value="&lt;pre style=&quot;border-color: var(--border-color); font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;Ptr sendHead&lt;/pre&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=middle;childLayout=stackLayout;horizontal=1;startSize=29;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="290" y="1210" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-48" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;sendHead初始化为recvhead, 如果没有FilterLayer设置，那就和recvhead一样的值&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;" parent="S4PnsvHIbKOA204sQYgr-47" vertex="1">
          <mxGeometry y="29" width="210" height="51" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="S4PnsvHIbKOA204sQYgr-49" target="S4PnsvHIbKOA204sQYgr-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="210" y="930" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-49" value="&lt;pre style=&quot;border-color: var(--border-color); font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;Ptr&lt;/pre&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=middle;childLayout=stackLayout;horizontal=1;startSize=29;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="60" y="1060" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-50" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;&quot; face=&quot;JetBrains Mono, monospace&quot; color=&quot;#080808&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;layer = FilterLayer1&lt;br&gt;&lt;/span&gt;&lt;/font&gt;nextSend =&amp;nbsp;&lt;br&gt;nextRecv =&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;" parent="S4PnsvHIbKOA204sQYgr-49" vertex="1">
          <mxGeometry y="29" width="210" height="51" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-51" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="S4PnsvHIbKOA204sQYgr-49" target="S4PnsvHIbKOA204sQYgr-46" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="75" y="54" as="sourcePoint" />
            <mxPoint x="125" y="54" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-59" value="" style="endArrow=classic;html=1;rounded=0;" parent="S4PnsvHIbKOA204sQYgr-49" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10" y="70" as="sourcePoint" />
            <mxPoint x="-20" y="70" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-53" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="1130" as="sourcePoint" />
            <mxPoint x="270" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="S4PnsvHIbKOA204sQYgr-55" target="S4PnsvHIbKOA204sQYgr-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-55" value="&lt;pre style=&quot;border-color: var(--border-color); font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;Ptr SendHead&lt;/pre&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=middle;childLayout=stackLayout;horizontal=1;startSize=29;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-170" y="1060" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-56" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;&quot; face=&quot;JetBrains Mono, monospace&quot; color=&quot;#080808&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;layer = FilterLayer2&lt;br&gt;&lt;/span&gt;&lt;/font&gt;nextSend =&amp;nbsp;&lt;br&gt;nextRecv =&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;" parent="S4PnsvHIbKOA204sQYgr-55" vertex="1">
          <mxGeometry y="29" width="210" height="51" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-57" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="S4PnsvHIbKOA204sQYgr-55" target="S4PnsvHIbKOA204sQYgr-50" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="75" y="54" as="sourcePoint" />
            <mxPoint x="125" y="54" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="S4PnsvHIbKOA204sQYgr-60" target="S4PnsvHIbKOA204sQYgr-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-295" y="1000" />
              <mxPoint x="-600" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-60" value="&lt;pre style=&quot;border-color: var(--border-color); font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;Ptr &lt;/pre&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=middle;childLayout=stackLayout;horizontal=1;startSize=29;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;html=1;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-400" y="1060" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-61" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;&quot; face=&quot;JetBrains Mono, monospace&quot; color=&quot;#080808&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;layer = ApplicationLayer&lt;br&gt;&lt;/span&gt;&lt;/font&gt;nextSend =&amp;nbsp;&lt;br&gt;nextRecv = null&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;" parent="S4PnsvHIbKOA204sQYgr-60" vertex="1">
          <mxGeometry y="29" width="210" height="51" as="geometry" />
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-62" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="S4PnsvHIbKOA204sQYgr-60" target="S4PnsvHIbKOA204sQYgr-56" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="75" y="54" as="sourcePoint" />
            <mxPoint x="125" y="54" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="S4PnsvHIbKOA204sQYgr-65" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-160" y="1130" as="sourcePoint" />
            <mxPoint x="-190" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LlYnxhrn1TKEqOn0lMnf-1" value="轮询selector, 如果有事件，取出IOHubReadyListener线程对象，&lt;span style=&quot;background-color: initial;&quot;&gt;用线程池pool去运行&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="870" y="345" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LlYnxhrn1TKEqOn0lMnf-2" value="只是起到selector wakeup的作用" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="860" y="410" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-1" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;SSLEngineFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-250" y="850" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-2" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ConnectionHeadersFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-490" y="850" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-3" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;NetworkLayer&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-105" y="1460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-4" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="60" y="1500" as="sourcePoint" />
            <mxPoint x="150" y="1500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-6" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;getIoHub().execute(reader)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="170" y="1475" width="210" height="45" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-7" value="新线程读数据" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="160" y="1500" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-8" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="404" y="1497" as="sourcePoint" />
            <mxPoint x="464" y="1497" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-9" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;等待启动完成ProtocolStack.&lt;span style=&quot;color:#00627a;font-style:italic;&quot;&gt;waitForStart&lt;/span&gt;()&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="480" y="1483" width="270" height="37" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-10" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;.AppleSystemUIFont&#39;;font-size:9.8pt;&quot;&gt;AgentProtocolClientFilterLayer&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-170" y="1650" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-11" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="65" y="1690" as="sourcePoint" />
            <mxPoint x="155" y="1690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-13" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;getIoHub().execute(writer)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="170" y="1520" width="210" height="45" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-16" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个writequeue: ByteBufferQueue包含new ByteBuffer[&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#871094&quot;&gt;&lt;i&gt;16&lt;/i&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;]， 每个8192字节，&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;client发送的内容都会写到这个writequeue来发送（不包含sslEngine.beginHanshake()）;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个recvqueue ByteBufferQueue用来写入接收的数据；&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个sendqueue：ByteBufferQueue也是用于发送数据（最终还是写入writequeue来发送）；&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="150" y="1370" width="698" height="90" as="geometry" />
        </mxCell>
        <mxCell id="FhYZfcETigPhw3zmsrr1-17" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个sendqueue:ByteBufferQueue包含new ByteBuffer[&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#871094&quot;&gt;&lt;i&gt;16&lt;/i&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;]， &lt;/font&gt;每个8192字节，用于发送数据， &lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;经由此层发送的数据，附加到sendqueue中进行发送；&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;启动开始发送&quot;Protocol:JNLP4-connect&quot;&lt;span style=&quot;color: rgb(8, 8, 8); font-size: 9.8pt;&quot;&gt;；-- 24字节==2字节长度+22字节串&lt;/span&gt;&lt;/pre&gt;&lt;font face=&quot;JetBrains Mono, monospace&quot; color=&quot;#080808&quot;&gt;&lt;/font&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;接收的数据不处理，直接交给下一层，所以没有recv queue相关属性&lt;/font&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="185" y="1630" width="740" height="90" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-1" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;.AppleSystemUIFont&#39;;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;AckFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-185" y="1850" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-2" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个sendqueue:ByteBufferQueue包含new ByteBuffer[&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#871094&quot;&gt;&lt;i&gt;16&lt;/i&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;]， &lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;每个8192字节，用于发送数据， 经由此层发送的数据，附加到sendqueue中进行发送；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;pre style=&quot;border-color: var(--border-color); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;启动开始发送&quot;ACK&quot;；-- 5字节==2字节长度+3字节字符串&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个recvqueue:ByteBufferQueue&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;接收的数据附加到这个queue中&lt;/font&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="130" y="1820" width="569" height="90" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-3" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="30" y="1879" as="sourcePoint" />
            <mxPoint x="120" y="1879" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-4" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;.AppleSystemUIFont&#39;;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;SSLEngineFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-190" y="1990" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-5" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;pre style=&quot;color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;执行握手sslEngine.beginHandshake()；&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;span style=&quot;color: rgb(8, 8, 8);&quot;&gt;创建ConcurrentLinkedQueue&amp;lt;&lt;span style=&quot;color:#000000;&quot;&gt;ByteBuffer&amp;gt; messages 保存发送的信息；&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;发送时会从message拿出信息，调用sslEngine.wrap()封装信息放到ByteBuffer对象里，再发送；&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;收到信息时会先accumulate在“ByteBuffer previous”，再判断是不是handshake信息，再用sslEngine.unwrap()解封装；&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="155" y="1960" width="570" height="110" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-6" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="30" y="2019.5" as="sourcePoint" />
            <mxPoint x="120" y="2019.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-7" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ConnectionHeadersFilterLayer&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-272.8" y="2120" width="290" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-8" value="&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个sendqueue:ByteBufferQueue包含new ByteBuffer[&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#871094&quot;&gt;&lt;i&gt;16&lt;/i&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;]， &lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;每个8192字节，用于发送数据， 经由此层发送的数据，附加到sendqueue中进行发送；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255, 255, 255); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;创建一个recvqueue:ByteBufferQueue&lt;font style=&quot;font-size: 9.8pt;&quot; color=&quot;#080808&quot;&gt;接收的数据附加到这个queue中&lt;/font&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="182.5" y="2090" width="569" height="90" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-9" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="40" y="2150" as="sourcePoint" />
            <mxPoint x="130" y="2150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-10" value="问题： 在发送和接收数据时，如何保证当前信息是完整的？而不是被分割放到前一条或下一条信息里？" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-550" y="1960" width="290" height="80" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-12" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ProtocolStack&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="-240" y="2320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-13" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-60" y="2360" as="sourcePoint" />
            <mxPoint x="160" y="2360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tP1lmiw2_yDiyHUFnw0z-14" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;span style=&quot;color:#000000;&quot;&gt;ProtocolStack.init()结束时才调用&lt;/span&gt;awaitStart.countDown(), 此后NetworkLayer才从通道读取返回的数据进行处理&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="60" y="2308" width="460" height="42" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-1" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ConnectionHeadersFilterLayer&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-690" y="2610" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-2" value="发送数据时，数据的转换过程：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-710" y="2530" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-3" value="doSend(ByteBuffer data)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-650" y="2760" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-5" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-590.5" y="2680" as="sourcePoint" />
            <mxPoint x="-590" y="2730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-7" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-590" y="2800" as="sourcePoint" />
            <mxPoint x="-589.5" y="2850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-8" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;当没finished或者&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;原先有数据时，&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;sendQueue.put(data)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-640" y="2853" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-9" value="sendQueue是一个ByteBuffer[]数组数据类型，每个数组元素ByteBuffer大小定义成8192，sendQueue会保存data参数数据（存储在sendQueue中是连续的，无边界，所以如果往里写的data数据比较大的话，sendQueue会动态申请更多ByteBuffer数组元素去保存，所以data的存储是会跨数组元素存储的）" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-1020" y="2833" width="370" height="90" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-10" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-590" y="2950" as="sourcePoint" />
            <mxPoint x="-589" y="3050" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-590" y="2960" />
              <mxPoint x="-589" y="2960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-11" value="然后循环发送&lt;br&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ByteBuffer tmp = ByteBuffer.&lt;span style=&quot;font-style:italic;&quot;&gt;allocate&lt;/span&gt;(&lt;span style=&quot;color:#871094;&quot;&gt;8192&lt;/span&gt;)；  //申请一个8192的ByteBuffer tmp&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;while (sendQueue.hasRemaining()) {&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;  ((Buffer) &lt;span style=&quot;color:#000000;&quot;&gt;tmp&lt;/span&gt;).clear();&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;  sendQueue.get(tmp); //填满tmp 8192字节，或者不满8192但是sendQueue已经读取完毕&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;  ptr.doSend(&lt;span style=&quot;color:#000000;&quot;&gt;tmp&lt;/span&gt;); //发送&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;}&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-690" y="3060" width="610" height="220" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-12" value="doSend()是上层应用层调用，我们无法预知data的大小，所以借助sendQueue这一动态空间先保存" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-890" y="2760" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-14" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;getNextSend().layer.doSend(tmp)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-700" y="3300" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-15" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-575.5" y="3240" as="sourcePoint" />
            <mxPoint x="-575" y="3290" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-575" y="3265" />
              <mxPoint x="-575" y="3265" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-16" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;&lt;pre style=&quot;border-color: var(--border-color); font-size: 9.8pt; font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace;&quot;&gt;SSLEngineFilterLayer&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="205" y="2600" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-17" value="doSend(ByteBuffer&amp;nbsp;message&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="234" y="2710" width="176" height="30" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-19" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-570" y="2800" as="sourcePoint" />
            <mxPoint x="-390" y="2890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-20" value="注意，这里有分叉，当sendQueue原先没数据时，&lt;br&gt;直接调用&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ptr.doSend(data)&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-500" y="2872" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-21" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;getNextSend().layer.doSend(data)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-510" y="2970" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-22" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-390" y="2930" as="sourcePoint" />
            <mxPoint x="-389.5" y="2980" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-389.5" y="2940" />
              <mxPoint x="-389.5" y="2940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-24" value="这个ByteBuffer message的大小也是未知的，因为tmp的值可能是上一层直接发送的data或上一层self_data， 也有可能是通过ByfeBufferQueue获取的8192字节的tmp; 也有可能是自身的self_data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="430" y="2700" width="406" height="60" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-25" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-390" y="2800" as="sourcePoint" />
            <mxPoint x="-120" y="2870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-26" value="注意，这里有分叉，这层有自身的数据要发送，&lt;br&gt;直接调用&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;ptr.doSend(self_data)&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-220" y="2870" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-27" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;getNextSend().layer.doSend(self_data)&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-210" y="2970" width="310" height="40" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-28" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-120" y="2930" as="sourcePoint" />
            <mxPoint x="-119.5" y="2980" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-119.5" y="2940" />
              <mxPoint x="-119.5" y="2940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-29" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;ByteBuffer newBuffer = &lt;span style=&quot;color:#000000;&quot;&gt;ByteBuffer&lt;/span&gt;.&lt;span style=&quot;font-style:italic;&quot;&gt;allocate&lt;/span&gt;(message.remaining() * &lt;span style=&quot;color:#1750eb;&quot;&gt;2&lt;/span&gt;)&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;text-align: left; font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;newBuffer.put(message)&lt;/pre&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="167" y="2780" width="540" height="87" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-30" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="338.5" y="2740" as="sourcePoint" />
            <mxPoint x="338.5" y="2790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-31" value="分配一个2倍空间存储, 为什么？？" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="725" y="2800" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="62yxdlusjtpypa1GuYyr-32" value="&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;JetBrains Mono&amp;quot;, monospace; font-size: 9.8pt;&quot;&gt;if (&lt;span style=&quot;color:#000000;&quot;&gt;State&lt;/span&gt;.&lt;span style=&quot;color:#871094;font-style:italic;&quot;&gt;CREDENTAILS_AVAILABLE&lt;/span&gt;.equals(&lt;span style=&quot;color:#871094;&quot;&gt;state&lt;/span&gt;)) {  //当不在状态时，不发&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;  while (&lt;span style=&quot;color:#0033b3;&quot;&gt;null &lt;/span&gt;!= (&lt;span style=&quot;color:#000000;&quot;&gt;request &lt;/span&gt;= &lt;span style=&quot;color:#871094;&quot;&gt;messages&lt;/span&gt;.poll())) {&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;  }&lt;/pre&gt;&lt;pre style=&quot;background-color:#ffffff;color:#080808;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;}&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="170" y="2872" width="560" height="102" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
